{% extends "layout.html" %}
{% block body %}
<div class="stack">

  <div class="card">
    {% include "_projet_budget_header.html" %}

    <div class="spacer"></div>

    <form method="post" class="row three">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <input name="libelle" placeholder="Libell√© (ex: Animateur - 0,5 ETP)" required>
      <select name="bloc">
        <option value="directe">Directe</option>
        <option value="indirecte">Indirecte</option>
      </select>
      <input name="code_plan" placeholder="Code (60/61/62/64...)" value="60" style="max-width:140px">
      <input name="montant_previsionnel" type="number" step="0.01" placeholder="Pr√©visionnel (‚Ç¨)" style="max-width:180px">
      <input name="montant_reel" type="number" step="0.01" placeholder="R√©el (‚Ç¨) (option)" style="max-width:180px">
      <input name="commentaire" placeholder="Commentaire (option)">
      <button class="btn ok" type="submit">Ajouter</button>
    </form>
  </div>

  <div class="card">
    <div class="tablewrap">
      <table>
        <thead>
          <tr>
            <th>Bloc</th>
            <th>Code</th>
            <th>Libell√©</th>
            <th>Pr√©visionnel</th>
            <th>R√©el</th>
            <th>Ventil√©</th>
            <th>Reste √† financer</th>
            <th>Engag√©</th>
            <th>Reste √† engager</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
        {% for c in charges %}
          <tr>
            <td>{{ c.bloc }}</td>
            <td>{{ c.code_plan }}</td>
            <td>{{ c.libelle }}</td>
            <td>{{ "%.2f"|format(c.montant_previsionnel or 0) }}‚Ç¨</td>
            <td>{{ "%.2f"|format(c.montant_reel or 0) }}‚Ç¨</td>
            <td>{{ "%.2f"|format(c.ventile or 0) }}‚Ç¨</td>
            <td>{{ "%.2f"|format(c.reste_a_financer or 0) }}‚Ç¨</td>
            <td>{{ "%.2f"|format(c.engage or 0) }}‚Ç¨</td>
            <td>{{ "%.2f"|format(c.reste_a_engager or 0) }}‚Ç¨</td>
            <td style="white-space:nowrap">
              <a class="btn" href="{{ url_for('projets.projet_budget_charge_edit', projet_id=projet.id, charge_id=c.id) }}">‚úèÔ∏è</a>
              <form method="post" action="{{ url_for('projets.projet_budget_charge_delete', projet_id=projet.id, charge_id=c.id) }}" style="display:inline" onsubmit="return confirm('Supprimer cette charge ?');">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button class="btn" type="submit">üóëÔ∏è</button>
              </form>
            </td>
          </tr>
        {% else %}
          <tr><td colspan="10" class="muted">Aucune charge pour le moment.</td></tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

</div>
{% endblock %}
